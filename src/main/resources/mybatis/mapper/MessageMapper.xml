<!-- src/main/resources/mybatis/mapper/MessageMapper.xml -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.free.message.dao.MessageDAO">

  <resultMap id="MessageMap" type="com.study.free.message.vo.MessageVO">
    <id     column="MSG_ID"     property="msgId"/>
    <result column="ROOM_ID"    property="roomId"/>
    <result column="SENDER_ID"  property="senderId"/>
    <result column="MSG_TYPE"   property="msgType"/>
    <result column="CONTENT"    property="content"/>
    <result column="AT_SEC"     property="atSec"/>
    <result column="META_JSON"  property="metaJson"/>
    <result column="CREATED_AT" property="createdAt"/>
    <result column="DEL_YN"     property="delYn"/>
  </resultMap>

  <insert id="insert" parameterType="com.study.free.message.vo.MessageVO">
    INSERT INTO MESSAGE
    (ROOM_ID, SENDER_ID, MSG_TYPE, CONTENT, AT_SEC, META_JSON)
    VALUES
    (#{roomId}, #{senderId}, #{msgType}, #{content,jdbcType=CLOB},
     #{atSec,jdbcType=NUMERIC}, #{metaJson,jdbcType=CLOB})
  </insert>

<select id="selectByRoom" parameterType="com.study.free.message.vo.MessageQueryVO"
        resultMap="MessageMap">
  SELECT
    MSG_ID, ROOM_ID, SENDER_ID, MSG_TYPE, CONTENT, AT_SEC, META_JSON,
    CREATED_AT, DEL_YN
  FROM MESSAGE
  WHERE ROOM_ID = #{roomId}
    AND NVL(DEL_YN, 'N') = 'N'
  ORDER BY CREATED_AT ASC
  FETCH FIRST #{limit} ROWS ONLY
</select>

</mapper>
